<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dispute Resolution | Admin Console</title>

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

  <link rel="stylesheet" href="../assets/css/admin_dispute_detail.css">

  <script src="../../Public_Assets/js/admin_guard.js"></script>
</head>
<body>

<header class="header">
  <a href="admin_dispute_dashboard.html" class="back-btn"><i class="ri-arrow-left-line"></i> Back</a>
  <span style="margin: 0 10px; color:#E2E8F0">|</span>
  <span style="font-weight:700;">Dispute #<span id="dID">Loading...</span></span>
</header>

<div class="layout-grid">

  <aside class="sidebar">
    <div class="card">
      <div id="statusDisplay" class="status-badge st-Open">...</div>

      <div class="form-group">
        <label class="label" for="updateStatus">Update Status</label>
        <select id="updateStatus">
          <option value="Open">Open</option>
          <option value="In Review">In Review</option>
          <option value="Resolved">Resolved</option>
        </select>
      </div>

      <div class="form-group">
        <label class="label" for="actionRequiredBy">Action Required From</label>
        <select id="actionRequiredBy" style="border-color:#6366f1; background:#EEF2FF; font-weight:600;">
          <option value="Admin">Admin (Processing)</option>
          <option value="Buyer">Buyer (Waiting for Evidence)</option>
          <option value="Seller">Seller (Waiting for Response)</option>
          <option value="Both">Both Parties</option>
          <option value="None">None (Dispute Closed)</option>
        </select>
        <div style="font-size:0.75rem; color:#64748B; margin-top:4px; line-height:1.4;">
          Selected party will see a red alert to submit evidence.
        </div>
      </div>

      <div class="line-dashed"></div>

      <div class="card-title">Resolution Decision</div>
      <input type="hidden" id="orderTotalHidden" value="0">

      <div class="form-group">
        <label class="label" for="drOutcome">Outcome</label>
        <select id="drOutcome">
          <option value="">-- Select Outcome --</option>
          <option value="refund_buyer">Refund Buyer (Full Refund)</option>
          <option value="refund_seller">Refund Seller (No Refund)</option>
          <option value="partial">Partial Refund</option>
        </select>
      </div>

      <div id="amountSection" style="display:none;">
        <div class="form-group">
          <label class="label" id="amountLabel" for="drAmount">Refund Amount to Buyer (MYR)</label>
          <input type="number" id="drAmount" placeholder="0.00" step="0.01" min="0">
        </div>

        <div class="calc-box" id="calcDisplay">
          <div class="calc-row">
            <span>Order Total:</span>
            <span id="calcTotal">RM 0.00</span>
          </div>
          <div class="calc-row">
            <span>To Buyer:</span>
            <span id="calcBuyer" class="highlight-green">- RM 0.00</span>
          </div>
          <div class="calc-row calc-total">
            <span>Seller Keeps:</span>
            <span id="calcSeller" class="highlight-blue">RM 0.00</span>
          </div>
        </div>
      </div>

      <button class="btn btn-primary" id="btnSaveDispute" style="margin-top: 16px;">
        <i class="ri-save-line"></i> Save Changes
      </button>
      <div id="saveMsg" style="text-align:center; font-size:0.8rem; margin-top:8px;"></div>
    </div>
  </aside>

  <main>

    <div class="card">
      <div class="card-title" style="display:flex; justify-content:space-between; align-items:center;">
        <span><i class="ri-file-list-3-line"></i> Original Refund Request</span>
        <span id="rrStatusBadge" class="rr-badge">Loading...</span>
      </div>

      <div class="meta-grid">
        <div class="meta-item">
          <span class="label">Request Type</span>
          <div id="rrType">--</div>
        </div>
        <div class="meta-item">
          <span class="label">Received Goods?</span>
          <div id="rrReceived" class="meta-val">--</div>
        </div>
        <div class="meta-item">
          <span class="label">Requested Amount</span>
          <div id="rrAmount" class="meta-val" style="color:var(--primary)">--</div>
        </div>
        <div class="meta-item">
          <span class="label">Attempt Count</span>
          <div id="rrAttempt" class="meta-val">--</div>
        </div>
      </div>

      <div class="desc-box">
        <span class="label">Buyer's Initial Reason</span>
        <div id="rrReasonText" style="font-weight:700; margin-bottom:6px; font-size:0.95rem; color:#0F172A;">--</div>
        <div id="rrDesc" style="color:#475569; font-size:0.9rem; line-height:1.6;">--</div>
      </div>

      <div id="returnTrackingBox" style="margin-top:16px; display:none;">
        <div class="label" style="margin-bottom:8px;">Return Tracking Number</div>
        <div style="display:flex; gap:10px; align-items:center;">
          <i class="ri-truck-line" style="font-size:1.2rem; color:var(--text-muted);"></i>
          <div id="rrTracking" class="tracking-code">N/A</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Dispute Timeline & Logs</div>
      <div id="timelineContainer" style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
        <div style="text-align:center; padding:20px; color:#94a3b8;">Loading history...</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Statements & Evidence</div>
      <div class="comparison-grid">
        <div class="party-col">
          <div class="user-header">
            <img src="" id="buyerAvatar" class="avatar" alt="B">
            <div>
              <div style="font-weight:700; font-size:0.9rem;" id="buyerName">Buyer</div>
              <div style="font-size:0.75rem; color:#64748B;" id="buyerId">ID: --</div>
            </div>
          </div>
          <div class="label">Dispute Reason</div>
          <div id="dReason" style="font-weight:600; margin-bottom:8px;">...</div>
          <div class="label">Details</div>
          <div id="dDetails" class="detail-text">...</div>
          <div class="evidence-grid" id="buyerEvidence"></div>
        </div>

        <div class="party-col">
          <div class="user-header">
            <img src="" id="sellerAvatar" class="avatar" alt="S">
            <div>
              <div style="font-weight:700; font-size:0.9rem;" id="sellerName">Seller</div>
              <div style="font-size:0.75rem; color:#64748B;" id="sellerId">ID: --</div>
            </div>
          </div>
          <div class="label">Seller Response</div>
          <div id="sellerResponse" class="detail-text" style="min-height:80px;">Waiting...</div>
          <div class="evidence-grid" id="sellerEvidence"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Replies (Visible to users)</div>
      <div class="comparison-grid">
        <div>
          <label class="label" for="drReplyBuyer">Reply to Buyer</label>
          <textarea id="drReplyBuyer" placeholder="Explain decision to buyer..."></textarea>
        </div>
        <div>
          <label class="label" for="drReplySeller">Reply to Seller</label>
          <textarea id="drReplySeller" placeholder="Explain decision to seller..."></textarea>
        </div>
      </div>
    </div>
  </main>
</div>

<script src="../assets/js/admin_dispute_detail.js"></script>

</body>
</html>